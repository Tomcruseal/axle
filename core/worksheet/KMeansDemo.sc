object KMeansDemo {

  println("KMeans Clustering Demo")               //> KMeans Clustering Demo

  import util.Random
  import math.{ Pi, cos, sin }
  import axle.ml._

  case class Foo(x: Double, y: Double, label: String)

  // Ïƒ2

  def randomFoo(center: Foo, sigmaSquared: Double) = {
    val distance = Random.nextGaussian() * sigmaSquared
    val angle = 2 * Pi * Random.nextDouble
    Foo(center.x + distance * cos(angle), center.y + distance * sin(angle), center.label)
  }                                               //> randomFoo: (center: KMeansDemo.Foo, sigmaSquared: Double)KMeansDemo.Foo

  val data = Random.shuffle(
    (0 until 20).map(i => randomFoo(Foo(15, 15, "A"), 2.0)) ++
      (0 until 30).map(i => randomFoo(Foo(5, 15, "B"), 2.0)) ++
      (0 until 25).map(i => randomFoo(Foo(15, 5, "C"), 2.0)) ++
      (0 until 25).map(i => randomFoo(Foo(12, 6, "D"), 2.0)) ++
      (0 until 25).map(i => randomFoo(Foo(4, 10, "E"), 2.0)) ++
      (0 until 25).map(i => randomFoo(Foo(8, 3, "F"), 2.0)))
                                                  //> data  : scala.collection.immutable.IndexedSeq[KMeansDemo.Foo] = Vector(Foo(4
                                                  //| .462171416904046,11.780373726027044,E), Foo(12.027319557669356,6.96073590593
                                                  //| 7705,D), Foo(4.475986103615707,9.134077845371012,E), Foo(8.620805410981875,4
                                                  //| .4747763758079895,F), Foo(16.351982102462117,16.853570489891958,A), Foo(14.4
                                                  //| 93944150599447,11.150731535151749,A), Foo(6.796051937903971,15.3575980643766
                                                  //| 63,B), Foo(3.9410592578796364,9.839814511814502,E), Foo(4.648894570653412,15
                                                  //| .16153354125349,B), Foo(12.886532053228056,4.775499550742986,C), Foo(7.14811
                                                  //| 6388807363,15.722127488632708,B), Foo(14.128324403372982,14.669379809831046,
                                                  //| A), Foo(14.71178578056932,14.92304212667586,A), Foo(4.298420763058789,16.299
                                                  //| 11768660031,B), Foo(5.14888687928307,14.53176715118412,B), Foo(14.0071844372
                                                  //| 55615,4.69854286126181,D), Foo(17.527593562193264,14.316239773839913,A), Foo
                                                  //| (6.526336518459535,2.3965231476699844,F), Foo(12.789737646131858,7.788316907
                                                  //| 554942,D), Foo(4.972184466313497,15.01996601369229,B), Foo(3.485813396216868
                                                  //| 5,16.877721313191742,B), Foo(5.2115717045020435,14.634414275280285,B), Foo(1
                                                  //| 4.62221804149668,3.23509407385504,C), Foo(3.525067651946702,16.1485312439524
                                                  //| 76,B), Foo(7.922719250435504,2.952594204144171,F), Foo(8.289904743915292,2.5
                                                  //| 626242641202968,F), Foo(16.08736146571629,6.523706191898325,C), Foo(6.650271
                                                  //| 584532463,3.190012602284305,F), Foo(5.605962136842619,15.052545679978397,B),
                                                  //|  Foo(4.117095707780531,9.974364968133447,E), Foo(7.226172704754981,0.9909355
                                                  //| 450893722,F), Foo(15.650143875604337,7.084495176606805,C), Foo(14.5539253489
                                                  //| 48534,5.075094269328533,C), Foo(3.502184420075844,8.405681141198015,E), Foo(
                                                  //| 13.594616780692919,3.745277726476126,C), Foo(5.095958033438966,12.9305612655
                                                  //| 96692,B), Foo(1.5498241527912255,13.526023218272384,B), Foo(6.47042959696862
                                                  //| 8,15.767208619858192,B), Foo(12.61995491494427,3.571740750195639,D), Foo(13.
                                                  //| 322527449841514,6.542787004072855,D), Foo(7.215977169428563,3.57392808282497
                                                  //| 66,F), Foo(7.079453254369717,16.838853597782798,B), Foo(12.487785867502671,6
                                                  //| .369428720985019,D), Foo(14.408596909807173,15.446440670087098,A), Foo(5.123
                                                  //| 863354756237,14.992159465727816,B), Foo(5.993509606668679,12.917233801298853
                                                  //| ,E), Foo(5.84796594032981,14.040605633477869,B), Foo(15.30146885201341,5.226
                                                  //| 462874691139,C), Foo(6.219233561416196,12.451221964864143,B), Foo(13.8463130
                                                  //| 29691622,4.007792455595066,D), Foo(11.600101600147033,4.325832282919862,C), 
                                                  //| Foo(10.477163585800954,5.367087523893337,D), Foo(15.18940080264167,8.1394007
                                                  //| 08525839,C), Foo(7.996402032336391,3.290045802538828,F), Foo(14.955876621476
                                                  //| 598,4.01488591725338,C), Foo(9.489669519107363,3.1458858631059288,F), Foo(15
                                                  //| .05322015964519,4.964668765709968,C), Foo(15.067057351320338,14.900949272944
                                                  //| 46,A), Foo(5.456504330697924,14.620152387466401,B), Foo(7.4842876874302435,3
                                                  //| .543544293630234,F), Foo(3.8010633958390825,18.461059226548336,B), Foo(15.20
                                                  //| 161483836857,3.6056278593012188,C), Foo(13.239056729463993,14.17942213207515
                                                  //| 7,A), Foo(7.829908527753073,4.221134043835146,F), Foo(15.823404026389936,13.
                                                  //| 161198155328927,A), Foo(9.29843861463565,2.806115120413279,F), Foo(14.592641
                                                  //| 476342347,5.943286079839934,C), Foo(2.16697078130116,7.695110951408812,E), F
                                                  //| oo(16.561084593251593,7.565193858635276,C), Foo(1.8570483920237106,12.308380
                                                  //| 677679715,B), Foo(6.503746477632899,14.226363553974235,B), Foo(12.5667219129
                                                  //| 43612,7.234596085219417,D), Foo(2.3976012812155076,11.79604831871674,E), Foo
                                                  //| (8.474179881717447,2.7098358532321485,F), Foo(4.27638680919673,10.1969786370
                                                  //| 06183,E), Foo(2.3669435158610024,10.732427523774952,E), Foo(4.25004985886603
                                                  //| 6,11.238619016692883,E), Foo(17.0885552243709,13.957668930072096,A), Foo(3.4
                                                  //| 61716213841868,10.692168323992057,E), Foo(15.066355332867467,5.5625126891338
                                                  //| 38,C), Foo(15.916847061454678,13.330125955383636,A), Foo(10.267131406436658,
                                                  //| 5.598670745163597,D), Foo(2.321668122521544,9.552001146015298,E), Foo(15.150
                                                  //| 409041770864,5.114900399351553,C), Foo(12.410990122002847,6.54697570386855,D
                                                  //| ), Foo(6.292999587422694,14.189897293812457,B), Foo(4.438025068504288,14.924
                                                  //| 889596643075,B), Foo(8.16205635496978,-0.17596657577003283,F), Foo(14.846170
                                                  //| 534960173,16.324636930646975,A), Foo(13.71106897597488,15.73568347871315,A),
                                                  //|  Foo(5.665605769906273,3.516887862257554,F), Foo(7.261257543879569,4.3693197
                                                  //| 71340561,F), Foo(4.9803748987327925,15.359138835618644,B), Foo(14.5366486844
                                                  //| 31235,13.443337098604475,A), Foo(12.179757432754336,7.476043219762741,D), Fo
                                                  //| o(7.445071931407414,3.0798509007342414,F), Foo(4.101477237207999,1.565378409
                                                  //| 8838046,F), Foo(13.390850525946119,5.1637061981412735,D), Foo(15.21898374536
                                                  //| 3532,14.088982142934173,A), Foo(3.9990223742053272,12.061546953175558,E), Fo
                                                  //| o(5.299221575760601,1.1900050045587582,F), Foo(14.707714003688716,5.29594018
                                                  //| 1930716,D), Foo(5.09154899800935,4.881119667049104,F), Foo(0.793165866286809
                                                  //| 5,12.443400674178696,E), Foo(3.2100122342460664,15.315862193405891,B), Foo(6
                                                  //| .990605542420509,13.462006079704377,B), Foo(12.78951948314457,5.318560070838
                                                  //| 925,C), Foo(3.4401310278422463,9.785367126559445,E), Foo(8.057522146939089,4
                                                  //| .644721791007957,F), Foo(11.721027733931766,5.8373153761029055,D), Foo(3.976
                                                  //| 849557862136,9.797710830271729,E), Foo(13.03966568333785,6.013197711322514,D
                                                  //| ), Foo(4.477962129221104,14.42256253314675,B), Foo(5.520120849025979,14.1421
                                                  //| 62989261513,B), Foo(15.388867245620565,14.927278577952645,A), Foo(13.0228588
                                                  //| 64074879,3.7480795075119464,D), Foo(14.751139617884489,7.576273821687105,C),
                                                  //|  Foo(10.785508959163245,5.759714213135031,D), Foo(2.417246776983458,9.233485
                                                  //| 049674389,E), Foo(6.660922185123727,11.874907922755625,E), Foo(4.86125254058
                                                  //| 8066,14.737130700954017,B), Foo(15.658676333001988,8.212905536746984,C), Foo
                                                  //| (4.272693089345591,10.833262782830708,E), Foo(12.019763002106382,6.143105625
                                                  //| 36183,D), Foo(15.416620415724168,17.01409159823299,A), Foo(14.07317802267829
                                                  //| ,6.328567573659934,D), Foo(13.483611326901297,5.723391199265676,C), Foo(4.56
                                                  //| 06186557409245,10.65602751836204,E), Foo(4.442413194716365,9.936505692774418
                                                  //| ,E), Foo(15.141186076114025,4.975308777194048,C), Foo(4.726216653471014,9.32
                                                  //| 0786777054623,E), Foo(16.933220007116446,15.777935586853735,A), Foo(8.203530
                                                  //| 86866867,2.768466457642717,F), Foo(16.258994687633837,3.716379884141791,C), 
                                                  //| Foo(15.0374430390237,4.990954150460958,C), Foo(10.892484780349564,5.36549875
                                                  //| 6773658,D), Foo(11.675097879512162,6.699945401081666,D), Foo(5.2262649149145
                                                  //| 3,10.779553283465725,E), Foo(8.919146116201432,0.9173998557588332,F), Foo(12
                                                  //| .45466376788838,6.178302700085919,D), Foo(4.896759074856211,11.3023908661381
                                                  //| 63,E), Foo(6.8679500343363555,12.443247389588825,B), Foo(10.380631114428986,
                                                  //| 3.4355208768521823,D), Foo(9.170552146575528,2.621846962350351,F), Foo(15.51
                                                  //| 560773957904,13.767384965811143,A), Foo(16.722183577841733,5.245369001305291
                                                  //| ,C), Foo(11.85401648012586,6.056955852879175,D), Foo(13.658737327536944,9.38
                                                  //| 0352950648291,C), Foo(13.540244868194879,14.55106130032916,A), Foo(7.9929030
                                                  //| 83319672,2.9834203921578997,F))

  val classifier = KMeans(
    data,
    N = 2,
    featureExtractor = (p: Foo) => List(p.x, p.y),
    constructor = (features: Seq[Double]) => Foo(features(0), features(1), ""),
    K = 6,
    iterations = 100)                             //> classifier  : axle.ml.KMeans.KMeansClassifier[KMeansDemo.Foo] = KMeansClass
                                                  //| ifier(Vector(Foo(4.462171416904046,11.780373726027044,E), Foo(12.0273195576
                                                  //| 69356,6.960735905937705,D), Foo(4.475986103615707,9.134077845371012,E), Foo
                                                  //| (8.620805410981875,4.4747763758079895,F), Foo(16.351982102462117,16.8535704
                                                  //| 89891958,A), Foo(14.493944150599447,11.150731535151749,A), Foo(6.7960519379
                                                  //| 03971,15.357598064376663,B), Foo(3.9410592578796364,9.839814511814502,E), F
                                                  //| oo(4.648894570653412,15.16153354125349,B), Foo(12.886532053228056,4.7754995
                                                  //| 50742986,C), Foo(7.148116388807363,15.722127488632708,B), Foo(14.1283244033
                                                  //| 72982,14.669379809831046,A), Foo(14.71178578056932,14.92304212667586,A), Fo
                                                  //| o(4.298420763058789,16.29911768660031,B), Foo(5.14888687928307,14.531767151
                                                  //| 18412,B), Foo(14.007184437255615,4.69854286126181,D), Foo(17.52759356219326
                                                  //| 4,14.316239773839913,A), Foo(6.526336518459535,2.3965231476699844,F), Foo(1
                                                  //| 2.789737646131858,7.788316907554942,D), Foo(4.972184466313497,15.0199660136
                                                  //| 9229,B), Foo(3.4858133962168685,16.877721313191742,B), Foo(5.21157170450204
                                                  //| 35,14.634414275280285,B), Foo(14.62221804149668,3.23509407385504,C), Foo(3.
                                                  //| 525067651946702,16.148531243952476,B), Foo(7.922719250435504,2.952594204144
                                                  //| 171,F), Foo(8.289904743915292,2.5626242641202968,F), Foo(16.08736146571629,
                                                  //| 6.523706191898325,C), Foo(6.650271584532463,3.190012602284305,F), Foo(5.605
                                                  //| 962136842619,15.052545679978397,B), Foo(4.117095707780531,9.974364968133447
                                                  //| ,E), Foo(7.226172704754981,0.9909355450893722,F), Foo(15.650143875604337,7.
                                                  //| 084495176606805,C), Foo(14.553925348948534,5.075094269328533,C), Foo(3.5021
                                                  //| 84420075844,8.405681141198015,E), Foo(13.594616780692919,3.745277726476126,
                                                  //| C), Foo(5.095958033438966,12.930561265596692,B), Foo(1.5498241527912255,13.
                                                  //| 526023218272384,B), Foo(6.470429596968628,15.767208619858192,B), Foo(12.619
                                                  //| 95491494427,3.571740750195639,D), Foo(13.322527449841514,6.542787004072855,
                                                  //| D), Foo(7.215977169428563,3.5739280828249766,F), Foo(7.079453254369717,16.8
                                                  //| 38853597782798,B), Foo(12.487785867502671,6.369428720985019,D), Foo(14.4085
                                                  //| 96909807173,15.446440670087098,A), Foo(5.123863354756237,14.992159465727816
                                                  //| ,B), Foo(5.993509606668679,12.917233801298853,E), Foo(5.84796594032981,14.0
                                                  //| 40605633477869,B), Foo(15.30146885201341,5.226462874691139,C), Foo(6.219233
                                                  //| 561416196,12.451221964864143,B), Foo(13.846313029691622,4.007792455595066,D
                                                  //| ), Foo(11.600101600147033,4.325832282919862,C), Foo(10.477163585800954,5.36
                                                  //| 7087523893337,D), Foo(15.18940080264167,8.139400708525839,C), Foo(7.9964020
                                                  //| Output exceeds cutoff limit. 

  classifier.confusionMatrix(data, (f: Foo) => f.label)

  import axle.visualize._
  
  val plot = Plot(classifier.distanceLogSeries(),
    connect = true,
    drawKey = true,
    title = Some("KMeans Mean Centroid Distances"),
    xAxis = 0.0,
    xAxisLabel = Some("step"),
    yAxis = 0,
    yAxisLabel = Some("average distance to centroid"))
  
  //show(classifier)
  //show(plot)

}